{% extends 'base.html.twig' %}

{% block title %}{{ company.name }} - Insider Activity{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .metrics-card {
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .metrics-card .card-header {
            background-color: #f8f9fa;
            font-weight: 600;
            border-bottom: 1px solid #e9ecef;
        }
        .transaction-type-Purchase {
            color: #198754;
            font-weight: 500;
        }
        .transaction-type-Sale {
            color: #dc3545;
            font-weight: 500;
        }
        .transaction-type-Option {
            color: #6c757d;
            font-weight: 500;
        }
        .metrics-nav {
            margin-bottom: 1.5rem;
        }
        .metrics-nav .nav-link {
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-right: 0.5rem;
            font-weight: 500;
            color: #495057;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            transition: all 0.2s ease-in-out;
        }
        .metrics-nav .nav-link:hover {
            background-color: #e9ecef;
            border-color: #dee2e6;
        }
        .metrics-nav .nav-link.active {
            color: #fff;
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .metrics-nav .nav-link i {
            margin-right: 0.5rem;
        }
        .insider-chart {
            height: 300px;
            width: 100%;
        }
        .insider-volume-chart {
            height: 250px;
            width: 100%;
        }
        .insider-filter {
            margin-bottom: 1.5rem;
        }
        .insider-filter label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .insider-profile {
            border-radius: 8px;
            background-color: #f8f9fa;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .insider-profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        .insider-profile-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background-color: #6c757d;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-right: 1rem;
        }
        .insider-profile-name {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .insider-profile-title {
            color: #6c757d;
            font-size: 0.875rem;
            margin-bottom: 0;
        }
        .insider-profile-stats {
            display: flex;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .insider-profile-stat {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 0.5rem;
            border-right: 1px solid #dee2e6;
        }
        .insider-profile-stat:last-child {
            border-right: none;
        }
        .insider-profile-stat-value {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .insider-profile-stat-label {
            color: #6c757d;
            font-size: 0.75rem;
            margin-bottom: 0;
        }
        .transaction-value-positive {
            color: #198754;
        }
        .transaction-value-negative {
            color: #dc3545;
        }
        .transaction-details {
            margin-top: 1rem;
        }
        .transaction-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .transaction-details-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0;
        }
        .transaction-details-date {
            color: #6c757d;
            font-size: 0.875rem;
        }
        .key-figure-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: 8px;
            background-color: #f8f9fa;
            margin-bottom: 1.5rem;
        }
        .key-figure-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .key-figure-label {
            color: #6c757d;
            font-size: 0.875rem;
        }
        .key-figure-positive {
            color: #198754;
        }
        .key-figure-negative {
            color: #dc3545;
        }
        .key-figure-neutral {
            color: #0d6efd;
        }
        .pagination-container {
            display: flex;
            justify-content: center;
            margin-top: 1.5rem;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Insider Transaction Volume Chart
            const volumeCtx = document.getElementById('insiderVolumeChart').getContext('2d');

            // Prepare data
            const monthLabels = [];
            const purchaseVolume = [];
            const saleVolume = [];

            // Get last 12 months
            const currentDate = new Date();
            for (let i = 0; i < 12; i++) {
                const date = new Date(currentDate);
                date.setMonth(date.getMonth() - i);
                const monthYear = date.toLocaleString('default', { month: 'short', year: 'numeric' });
                monthLabels.unshift(monthYear);

                // Random data for demo (replace with actual aggregated data)
                purchaseVolume.unshift(Math.floor(Math.random() * 500000));
                saleVolume.unshift(Math.floor(Math.random() * 700000) * -1); // Negative for sales
            }

            new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [
                        {
                            label: 'Purchase Volume',
                            data: purchaseVolume,
                            backgroundColor: 'rgba(25, 135, 84, 0.6)',
                            borderColor: 'rgba(25, 135, 84, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Sale Volume',
                            data: saleVolume,
                            backgroundColor: 'rgba(220, 53, 69, 0.6)',
                            borderColor: 'rgba(220, 53, 69, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Month'
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Transaction Value ($)'
                            },
                            ticks: {
                                callback: function(value) {
                                    if (value === 0) return '0';
                                    if (value > 0) {
                                        return '+$' + Math.abs(value).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                    } else {
                                        return '-$' + Math.abs(value).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                    }
                                }
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Monthly Insider Transaction Volume'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.raw > 0) {
                                        label += '+$' + Math.abs(context.raw).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                    } else {
                                        label += '-$' + Math.abs(context.raw).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            // Insider Holdings Chart
            const holdingsCtx = document.getElementById('insiderHoldingsChart').getContext('2d');

            // Get top 5 insiders (from the transactions list)
            const insiders = {};
            document.querySelectorAll('.insider-name').forEach(function(el) {
                const name = el.textContent.trim();
                const sharesOwned = parseInt(el.getAttribute('data-shares-owned').replace(/,/g, ''));
                insiders[name] = (insiders[name] || 0) + sharesOwned;
            });

            // Sort insiders by shares owned and get top 5
            const topInsiders = Object.entries(insiders)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            new Chart(holdingsCtx, {
                type: 'pie',
                data: {
                    labels: topInsiders.map(insider => insider[0]),
                    datasets: [{
                        data: topInsiders.map(insider => insider[1]),
                        backgroundColor: [
                            'rgba(25, 135, 84, 0.7)',
                            'rgba(13, 110, 253, 0.7)',
                            'rgba(255, 193, 7, 0.7)',
                            'rgba(111, 66, 193, 0.7)',
                            'rgba(23, 162, 184, 0.7)'
                        ],
                        borderColor: [
                            'rgba(25, 135, 84, 1)',
                            'rgba(13, 110, 253, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(111, 66, 193, 1)',
                            'rgba(23, 162, 184, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 5 Insiders by Shares Owned'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")} shares (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
{% endblock %}

{% block body %}
    <div class="container mt-4">
        <h1>{{ company.name }} ({{ company.tickerSymbol }}) - Insider Activity</h1>

        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ path('company_show', {'id': company.id}) }}">Company Profile</a></li>
                <li class="breadcrumb-item"><a href="{{ path('company_additional_metrics', {'id': company.id}) }}">Additional Metrics</a></li>
                <li class="breadcrumb-item active" aria-current="page">Insider Activity</li>
            </ol>
        </nav>

        <div class="metrics-nav">
            <ul class="nav nav-pills">
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('company_additional_metrics', {'id': company.id}) }}">
                        <i class="fas fa-chart-line"></i> Overview
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('company_esg_dashboard', {'id': company.id}) }}">
                        <i class="fas fa-leaf"></i> ESG
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('company_sec_filings', {'id': company.id}) }}">
                        <i class="fas fa-file-alt"></i> SEC Filings
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{{ path('company_insider_activity', {'id': company.id}) }}">
                        <i class="fas fa-user-tie"></i> Insider Activity
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('company_institutional_ownership', {'id': company.id}) }}">
                        <i class="fas fa-building"></i> Institutional Ownership
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('company_analyst_coverage', {'id': company.id}) }}">
                        <i class="fas fa-chart-bar"></i> Analyst Coverage
                    </a>
                </li>
            </ul>
        </div>

        <div class="row">
            <!-- Key Figures -->
            <div class="col-md-3">
                <div class="key-figure-card">
                    {% set totalTransactions = insiderTransactions|length %}
                    <div class="key-figure-value key-figure-neutral">{{ totalTransactions }}</div>
                    <div class="key-figure-label">Total Transactions<br>Last 12 Months</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="key-figure-card">
                    {% set purchaseCount = 0 %}
                    {% for transaction in insiderTransactions %}
                        {% if transaction.transactionType matches '/purchase/i' %}
                            {% set purchaseCount = purchaseCount + 1 %}
                        {% endif %}
                    {% endfor %}
                    <div class="key-figure-value key-figure-positive">{{ purchaseCount }}</div>
                    <div class="key-figure-label">Purchase Transactions<br>Last 12 Months</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="key-figure-card">
                    {% set saleCount = 0 %}
                    {% for transaction in insiderTransactions %}
                        {% if transaction.transactionType matches '/sale/i' %}
                            {% set saleCount = saleCount + 1 %}
                        {% endif %}
                    {% endfor %}
                    <div class="key-figure-value key-figure-negative">{{ saleCount }}</div>
                    <div class="key-figure-label">Sale Transactions<br>Last 12 Months</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="key-figure-card">
                    {% set purchaseValue = 0 %}
                    {% set saleValue = 0 %}
                    {% for transaction in insiderTransactions %}
                        {% if transaction.transactionType matches '/purchase/i' %}
                            {% set purchaseValue = purchaseValue + transaction.value %}
                        {% elseif transaction.transactionType matches '/sale/i' %}
                            {% set saleValue = saleValue + transaction.value %}
                        {% endif %}
                    {% endfor %}
                    {% set netValue = purchaseValue - saleValue %}
                    <div class="key-figure-value {% if netValue > 0 %}key-figure-positive{% elseif netValue < 0 %}key-figure-negative{% else %}key-figure-neutral{% endif %}">
                        {% if netValue > 0 %}+{% elseif netValue < 0 %}-{% endif %}${{ (netValue|abs)|number_format }}
                    </div>
                    <div class="key-figure-label">Net Transaction Value<br>Last 12 Months</div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- Transaction Volume Chart -->
            <div class="col-md-8">
                <div class="card metrics-card">
                    <div class="card-header">
                        Transaction Volume Trend
                    </div>
                    <div class="card-body">
                        <div class="insider-volume-chart">
                            <canvas id="insiderVolumeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Insider Holdings Chart -->
            <div class="col-md-4">
                <div class="card metrics-card">
                    <div class="card-header">
                        Insider Holdings
                    </div>
                    <div class="card-body">
                        <div class="insider-chart">
                            <canvas id="insiderHoldingsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card metrics-card">
                    <div class="card-header">
                        Insider Transactions
                    </div>
                    <div class="card-body">
                        <!-- Filters -->
                        <div class="insider-filter">
                            <form method="get" action="{{ path('company_insider_activity', {'id': company.id}) }}" class="row g-3">
                                <div class="col-md-4">
                                    <label for="type">Transaction Type</label>
                                    <select id="type" name="type" class="form-select">
                                        <option value="">All Types</option>
                                        {% for type in transactionTypes %}
                                            <option value="{{ type }}" {% if currentType == type %}selected{% endif %}>{{ type }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="insider">Insider</label>
                                    <select id="insider" name="insider" class="form-select">
                                        <option value="">All Insiders</option>
                                        {% for name in insiderNames %}
                                            <option value="{{ name }}" {% if currentInsider == name %}selected{% endif %}>{{ name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-4 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                                    {% if currentType or currentInsider %}
                                        <a href="{{ path('company_insider_activity', {'id': company.id}) }}" class="btn btn-outline-secondary ms-2">Clear Filters</a>
                                    {% endif %}
                                </div>
                            </form>
                        </div>

                        {% if insiderTransactions is not empty %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Insider</th>
                                            <th>Title</th>
                                            <th>Type</th>
                                            <th>Shares</th>
                                            <th>Avg Price</th>
                                            <th>Value</th>
                                            <th>Shares Owned</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for transaction in insiderTransactions %}
                                            <tr>
                                                <td>{{ transaction.transactionDate|date('M d, Y') }}</td>
                                                <td class="insider-name" data-shares-owned="{{ transaction.sharesOwned|number_format }}">{{ transaction.insiderName }}</td>
                                                <td>{{ transaction.title }}</td>
                                                <td>
                                                    {% if transaction.transactionType matches '/purchase/i' %}
                                                        <span class="transaction-type-Purchase">{{ transaction.transactionType }}</span>
                                                    {% elseif transaction.transactionType matches '/sale/i' %}
                                                        <span class="transaction-type-Sale">{{ transaction.transactionType }}</span>
                                                    {% else %}
                                                        <span class="transaction-type-Option">{{ transaction.transactionType }}</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ transaction.shares|number_format }}</td>
                                                <td>
                                                    {% if transaction.shares > 0 %}
                                                        ${{ (transaction.value / transaction.shares)|number_format(2) }}
                                                    {% else %}
                                                        N/A
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if transaction.transactionType matches '/purchase/i' %}
                                                        <span class="transaction-value-positive">${{ transaction.value|number_format }}</span>
                                                    {% elseif transaction.transactionType matches '/sale/i' %}
                                                        <span class="transaction-value-negative">${{ transaction.value|number_format }}</span>
                                                    {% else %}
                                                        ${{ transaction.value|number_format }}
                                                    {% endif %}
                                                </td>
                                                <td>{{ transaction.sharesOwned|number_format }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <div class="pagination-container">
                                <nav aria-label="Insider transactions pagination">
                                    <ul class="pagination">
                                        <li class="page-item disabled">
                                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                        </li>
                                        <li class="page-item active" aria-current="page">
                                            <a class="page-link" href="#">1</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">2</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">3</a>
                                        </li>
                                        <li class="page-item">
                                            <a class="page-link" href="#">Next</a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <p class="mb-0">No insider transactions found for {{ company.name }}{% if currentType or currentInsider %} with the selected filters{% endif %}.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Notable Insider Profiles (show only if insider transactions exist) -->
        {% if insiderTransactions is not empty %}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card metrics-card">
                        <div class="card-header">
                            Key Insiders
                        </div>
                        <div class="card-body">
                            <!-- Group transactions by insider and get top 3 by shares owned -->
                            {% set insiders = {} %}
                            {% for transaction in insiderTransactions %}
                                {% set insiderName = transaction.insiderName %}
                                {% if insiders[insiderName] is not defined %}
                                    {% set insiders = insiders|merge({
                                        (insiderName): {
                                            'name': insiderName,
                                            'title': transaction.title,
                                            'sharesOwned': transaction.sharesOwned,
                                            'transactions': 1,
                                            'purchases': transaction.transactionType matches '/purchase/i' ? 1 : 0,
                                            'sales': transaction.transactionType matches '/sale/i' ? 1 : 0,
                                            'purchaseValue': transaction.transactionType matches '/purchase/i' ? transaction.value : 0,
                                            'saleValue': transaction.transactionType matches '/sale/i' ? transaction.value : 0
                                        }
                                    }) %}
                                {% else %}
                                    {% set currentInsider = insiders[insiderName] %}
                                    {% set insiders = insiders|merge({
                                        (insiderName): {
                                            'name': insiderName,
                                            'title': transaction.title,
                                            'sharesOwned': transaction.sharesOwned,
                                            'transactions': currentInsider.transactions + 1,
                                            'purchases': currentInsider.purchases + (transaction.transactionType matches '/purchase/i' ? 1 : 0),
                                            'sales': currentInsider.sales + (transaction.transactionType matches '/sale/i' ? 1 : 0),
                                            'purchaseValue': currentInsider.purchaseValue + (transaction.transactionType matches '/purchase/i' ? transaction.value : 0),
                                            'saleValue': currentInsider.saleValue + (transaction.transactionType matches '/sale/i' ? transaction.value : 0)
                                        }
                                    }) %}
                                {% endif %}
                            {% endfor %}

                            <!-- Sort insiders by shares owned -->
                            {% set sortedInsiders = [] %}
                            {% for name, data in insiders %}
                                {% set sortedInsiders = sortedInsiders|merge([data]) %}
                            {% endfor %}
                            {% set sortedInsiders = sortedInsiders|sort((a, b) => b.sharesOwned <=> a.sharesOwned) %}

                            <div class="row">
                                {% for insider in sortedInsiders|slice(0, 3) %}
                                    <div class="col-md-4">
                                        <div class="insider-profile">
                                            <div class="insider-profile-header">
                                                <div class="insider-profile-avatar">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                                <div>
                                                    <h5 class="insider-profile-name">{{ insider.name }}</h5>
                                                    <p class="insider-profile-title">{{ insider.title }}</p>
                                                </div>
                                            </div>

                                            <div class="insider-profile-stats">
                                                <div class="insider-profile-stat">
                                                    <div class="insider-profile-stat-value">{{ insider.sharesOwned|number_format }}</div>
                                                    <p class="insider-profile-stat-label">Shares Owned</p>
                                                </div>
                                                <div class="insider-profile-stat">
                                                    <div class="insider-profile-stat-value">{{ insider.transactions }}</div>
                                                    <p class="insider-profile-stat-label">Transactions</p>
                                                </div>
                                                <div class="insider-profile-stat">
                                                    <div class="insider-profile-stat-value">
                                                        <span class="{% if (insider.purchaseValue - insider.saleValue) > 0 %}transaction-value-positive{% elseif (insider.purchaseValue - insider.saleValue) < 0 %}transaction-value-negative{% endif %}">
                                                            {% if (insider.purchaseValue - insider.saleValue) > 0 %}+{% elseif (insider.purchaseValue - insider.saleValue) < 0 %}-{% endif %}
                                                            ${{ ((insider.purchaseValue - insider.saleValue)|abs)|number_format }}
                                                        </span>
                                                    </div>
                                                    <p class="insider-profile-stat-label">Net Transaction Value</p>
                                                </div>
                                            </div>

                                            <div class="mt-3">
                                                <a href="{{ path('company_insider_activity', {'id': company.id, 'insider': insider.name}) }}" class="btn btn-sm btn-outline-primary w-100">
                                                    View Transactions
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="row mt-4">
            <div class="col-12">
                <div class="card metrics-card">
                    <div class="card-header">
                        Understanding Insider Transactions
                    </div>
                    <div class="card-body">
                        <h5>What are Insider Transactions?</h5>
                        <p>
                            Insider transactions refer to the buying and selling of company stock by individuals who have access to non-public, material information about the company. These individuals typically include:
                        </p>
                        <ul>
                            <li>Directors and senior officers</li>
                            <li>Board members</li>
                            <li>Beneficial owners with more than 10% ownership</li>
                            <li>Other key executives and decision-makers</li>
                        </ul>

                        <h5>Why Insider Transactions Matter</h5>
                        <p>
                            Insider trading activity is often considered a signal about company prospects:
                        </p>
                        <ul>
                            <li><strong>Insider Buying:</strong> May indicate management's confidence in the company's future performance</li>
                            <li><strong>Insider Selling:</strong> Could signal management concern, though selling often occurs for personal reasons (tax planning, diversification, etc.)</li>
                            <li><strong>Transaction Size:</strong> Larger transactions tend to be more significant signals</li>
                            <li><strong>Multiple Insiders:</strong> When several insiders make similar transactions, the signal is typically stronger</li>
                        </ul>

                        <h5>Regulatory Context</h5>
                        <p>
                            Insider transactions are legally permissible when:
                        </p>
                        <ul>
                            <li>Properly disclosed through SEC Form 4 filings (within 2 business days)</li>
                            <li>Not based on material non-public information</li>
                            <li>Compliant with the company's internal trading policies</li>
                            <li>Not occurring during blackout periods</li>
                        </ul>

                        <div class="alert alert-info mt-3">
                            <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>Insider Trading vs. Illegal Insider Trading</h6>
                            <p class="mb-0">All insider transactions shown here are legal and properly disclosed. Illegal insider trading occurs when insiders trade based on material, non-public information, which is prohibited by securities law.</p>
                        </div>
